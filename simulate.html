<!-- … (אותו <head> בדיוק כמו ב-גרסה הקודמת) … -->
<body>
  <div class="phone">
    <!-- NAVBAR -->
    <nav class="top-nav">
      <a href="tel:1201">📞 ער"ן</a>
      <a href="mainpage.html">🏠 תפריט</a>
    </nav>

    <!-- SELECTOR -->
    <div id="scenarioContainer">
      <label for="scenarioSelect">בחר/י דמות (גיל + קשר):</label>
      <select id="scenarioSelect">
        <option value="" selected disabled>-- בחר/י --</option>
        <option value="10_student">ילד/ה בן/בת 10 – תלמיד/ה שלך</option>
        <option value="16_neighbor">מתבגר/ת בן/בת 16 – שכן/ית</option>
        <option value="22_classmate">צעיר/ה בן/בת 22 – חבר/ת כיתה</option>
        <option value="35_colleague">מבוגר/ת בן/בת 35 – קולגה</option>
        <option value="75_neighbor">קשיש/ה בן/בת 75 – שכן/ית</option>
      </select>
    </div>

    <!-- CHAT -->
    <div id="chatContainer">
      <div id="instructionsDiv"></div>
      <div id="chat"></div>

      <!-- INPUT BAR -->
      <div id="inputContainer">
        <input id="userInput" type="text" placeholder="הקלד/י הודעה…" />
        <button id="sendBtn" class="primary">➤</button>
        <!-- NEW SUMMARY BUTTON -->
        <button id="summaryBtn" class="secondary">סיכום</button>
      </div>
    </div>
  </div>

  <script>
    /* ELEMENTS */
    const scenarioSelect  = document.getElementById('scenarioSelect');
    const scenarioContainer = document.getElementById('scenarioContainer');
    const chatContainer   = document.getElementById('chatContainer');
    const instructionsDiv = document.getElementById('instructionsDiv');
    const chat            = document.getElementById('chat');
    const userInput       = document.getElementById('userInput');
    const sendBtn         = document.getElementById('sendBtn');
    const summaryBtn      = document.getElementById('summaryBtn');   // ← כפתור חדש

    /* … (objects: scenarios, summarySystem, avatars, labels – בדיוק כמו קודם) … */

    /* STATE */
    let messages = [];
    let scenarioSystemPrompt = '';

    /* EVENTS */
    scenarioSelect.onchange = () => {
      const k = scenarioSelect.value;
      if(!k) return;
      scenarioContainer.style.display = 'none';
      chatContainer.style.display = 'flex';
      instructionsDiv.textContent = scenarios[k].d;
      messages = [];
      scenarioSystemPrompt = scenarios[k].p.trim();
      userInput.focus();
    };
    sendBtn.onclick = handleSend;
    userInput.onkeyup = e => (e.key === 'Enter') && handleSend();
    summaryBtn.onclick = handleSummary;         // ← מאזין חדש

    /* … (addBubble(), ai() – לא משתנים) … */

    async function handleSend(){
      const txt = userInput.value.trim();
      if(!txt) return;
      addBubble('user', txt);
      messages.push({role:'user', content:txt});
      userInput.value = '';

      /* BOT REPLY (always friend-in-distress) */
      const convo = [{role:'system', content:scenarioSystemPrompt}, ...messages];
      ai({messages: convo})
        .then(rep => { addBubble('bot', rep || '…'); messages.push({role:'assistant', content:rep}); })
        .catch(() => addBubble('bot','שגיאה 😕'));
    }

    /* SUMMARY FEEDBACK FOR WHOLE CHAT (triggered by new button) */
    async function handleSummary(){
      if(!messages.length) return;
      const userMsgs = messages.filter(m => m.role === 'user')
                               .map(m => ({role:'user', content:m.content}));
      ai({messages:[{role:'system', content:summarySystem}, ...userMsgs]})
        .then(sum => addBubble('evaluation', sum || 'שגיאה בהערכה.'))
        .catch(()  => addBubble('evaluation','שגיאה בהערכה.'));
    }
  </script>
</body>
</html>
